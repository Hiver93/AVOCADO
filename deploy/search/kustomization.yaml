apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namePrefix: avocado-
resources:
- deployment.yaml
- service.yaml

vars:
- fieldref:
    fieldPath: spec.template.spec.containers[0].image
  name: IMAGE_TAG
  objref:
    apiVersion: apps/v1
    kind: Deployment
    name: search
images:
- name: avocado-search
  newName: 749740892195.dkr.ecr.ap-northeast-2.amazonaws.com/avocado-search
  newTag: "329"
